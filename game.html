l<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emory</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f9f9f9;
    }
    .container {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .emoji-container {
      font-size: 24px;
      background-color: #f0f8ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      min-height: 40px;
      text-align: center;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 15px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      resize: vertical;
    }
    .result-box {
      background-color: #f0fff0;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      min-height: 100px;
    }
    .button-group {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    .start-btn {
      background-color: #4CAF50;
      color: white;
    }
    .submit-btn {
      background-color: #2196F3;
      color: white;
    }
    .save-btn {
      background-color: #9C27B0;
      color: white;
    }
    button:hover {
      opacity: 0.9;
    }
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .leaderboard {
      margin-top: 30px;
    }
    .leaderboard h2 {
      text-align: center;
      color: #333;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
      color: #333;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #f1f1f1;
    }
    .score {
      font-weight: bold;
      color: #E65100;
    }
    .loading {
      display: none;
      text-align: center;
      margin: 10px 0;
    }
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: #09f;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .api-key-container {
      margin-bottom: 20px;
    }
    .api-key-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    .tab-container {
      display: flex;
      border-bottom: 1px solid #ddd;
      margin-bottom: 20px;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid transparent;
      border-radius: 5px 5px 0 0;
    }
    .tab.active {
      border: 1px solid #ddd;
      border-bottom: none;
      background-color: white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Emory</h1>
      <p>ì´ëª¨í‹°ì½˜ì„ í™œìš©í•˜ì—¬ ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸°ë¥¼ ì‘ì„±í•˜ê³  AIì—ê²Œ í‰ê°€ë°›ì•„ë³´ì„¸ìš”!</p>
    </div>
    
    <!-- API í‚¤ê°€ ì½”ë“œì— ì§ì ‘ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤ -->
    <div class="api-key-container" style="display: none;">
      <input type="password" id="apiKeyInput" class="api-key-input" value="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" />
    </div>
    
    <div class="tab-container">
      <div class="tab active" onclick="openTab('game')">ê²Œì„ í”Œë ˆì´</div>
      <div class="tab" onclick="openTab('leaderboard')">ìˆœìœ„í‘œ</div>
    </div>
    
    <div id="game" class="tab-content active">
      <div class="emoji-container" id="emojiDisplay">ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´ëª¨í‹°ì½˜ì„ ë°›ì•„ë³´ì„¸ìš”</div>
      
      <textarea id="storyInput" placeholder="ì´ëª¨í‹°ì½˜ì„ í™œìš©í•œ ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”..."></textarea>
      
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</p>
      </div>
      
      <div class="result-box" id="resultDisplay"></div>
      
      <div class="button-group">
        <button class="start-btn" id="startBtn">ğŸ² ì´ëª¨í‹°ì½˜ ë°›ê¸°</button>
        <button class="submit-btn" id="submitBtn" disabled>ğŸ“¨ ì´ì•¼ê¸° ì œì¶œ</button>
        <button class="save-btn" id="saveBtn" disabled>ğŸ’¾ ê²°ê³¼ ì €ì¥</button>
      </div>
    </div>
    
    <div id="leaderboard" class="tab-content">
      <div class="leaderboard">
        <h2>ğŸ† ìˆœìœ„í‘œ ğŸ†</h2>
        <table id="leaderboardTable">
          <thead>
            <tr>
              <th>ìˆœìœ„</th>
              <th>ë‹‰ë„¤ì„</th>
              <th>ì´ëª¨í‹°ì½˜</th>
              <th>ì ìˆ˜</th>
              <th>ë‚ ì§œ</th>
            </tr>
          </thead>
          <tbody id="leaderboardBody">
            <!-- ìˆœìœ„ ë°ì´í„°ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // ì „ì—­ ë³€ìˆ˜
    let currentEmojis = "";
    let currentScore = 0;
    let leaderboardData = JSON.parse(localStorage.getItem('emojiGameLeaderboard')) || [];
    
    // DOM ìš”ì†Œ
    const apiKeyInput = document.getElementById('apiKeyInput');
    const emojiDisplay = document.getElementById('emojiDisplay');
    const storyInput = document.getElementById('storyInput');
    const resultDisplay = document.getElementById('resultDisplay');
    const startBtn = document.getElementById('startBtn');
    const submitBtn = document.getElementById('submitBtn');
    const saveBtn = document.getElementById('saveBtn');
    const loadingIndicator = document.getElementById('loading');
    
    // API í‚¤ëŠ” ì´ë¯¸ ì½”ë“œì— í¬í•¨ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì €ì¥ ê´€ë ¨ ì½”ë“œ ì œê±°
    
    // íƒ­ ì „í™˜ ê¸°ëŠ¥
    function openTab(tabName) {
      const tabs = document.getElementsByClassName('tab');
      const tabContents = document.getElementsByClassName('tab-content');
      
      for (let i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove('active');
        tabContents[i].classList.remove('active');
      }
      
      document.getElementById(tabName).classList.add('active');
      event.currentTarget.classList.add('active');
      
      if (tabName === 'leaderboard') {
        updateLeaderboardDisplay();
      }
    }
    
    // Groq API í˜¸ì¶œ í•¨ìˆ˜
    async function callGroqAPI(prompt) {
      const apiKey = apiKeyInput.value; // ì½”ë“œì— í¬í•¨ëœ API í‚¤ ì‚¬ìš©
      
      try {
        const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${apiKey}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: "meta-llama/llama-4-scout-17b-16e-instruct",
            messages: [{ role: "user", content: prompt }]
          })
        });
        
        if (!response.ok) {
          throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
        }
        
        const data = await response.json();
        return data.choices[0].message.content.trim();
      } catch (error) {
        console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
        alert(`API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
        return null;
      }
    }
    
    // ì´ëª¨í‹°ì½˜ ìƒì„±
    async function getEmojisFromAI() {
      loadingIndicator.style.display = 'block';
      const prompt = "ì¬ë¯¸ìˆëŠ” ì´ì•¼ê¸° ì£¼ì œë¡œ ì“¸ ìˆ˜ ìˆëŠ” ì´ëª¨í‹°ì½˜ì„ 3~5ê°œ ì œì‹œí•´ì¤˜. ë‹¤ë¥¸ ì„¤ëª…ì€ í•˜ì§€ ë§ê³  ì´ëª¨í‹°ì½˜ë§Œ ë³´ì—¬ì¤˜.";
      
      const emojis = await callGroqAPI(prompt);
      loadingIndicator.style.display = 'none';
      
      if (emojis) {
        return emojis;
      }
      return null;
    }
    
    // ì´ì•¼ê¸° í‰ê°€
    async function evaluateStory(emojis, story) {
      loadingIndicator.style.display = 'block';
      const prompt = `
        ë‹¤ìŒ ì´ëª¨í‹°ì½˜ë“¤ì„ í™œìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì“´ ì´ì•¼ê¸°ë¥¼ í‰ê°€í•´ì¤˜.

        ì´ëª¨í‹°ì½˜: ${emojis}
        ì´ì•¼ê¸°: ${story}

        0ì ì—ì„œ 100ì  ì‚¬ì´ ì ìˆ˜ì™€ ê°„ë‹¨í•œ í‰ê°€ë¥¼ í•´ì¤˜. í˜•ì‹ì€ ì•„ë˜ì²˜ëŸ¼ í•´ì¤˜:

        ì ìˆ˜: [ìˆ«ì]
        í‰ê°€: [ê°„ë‹¨í•œ í”¼ë“œë°±]
      `;
      
      const evaluation = await callGroqAPI(prompt);
      loadingIndicator.style.display = 'none';
      
      if (evaluation) {
        // ì ìˆ˜ ì¶”ì¶œ
        const scoreMatch = evaluation.match(/ì ìˆ˜:\s*(\d+)/);
        if (scoreMatch && scoreMatch[1]) {
          currentScore = parseInt(scoreMatch[1]);
        }
        return evaluation;
      }
      return null;
    }
    
    // ì €ì¥ ê¸°ëŠ¥
    function saveResult() {
      const story = storyInput.value.trim();
      const result = resultDisplay.innerHTML;
      
      if (!story || !result) {
        alert('ì´ì•¼ê¸°ë‚˜ í‰ê°€ ê²°ê³¼ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
        return;
      }
      
      // ë‹‰ë„¤ì„ ì…ë ¥ ë°›ê¸°
      const nickname = prompt('ìˆœìœ„í‘œì— ì €ì¥í•  ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:', 'ìµëª…');
      if (!nickname) return;
      
      // í˜„ì¬ ë‚ ì§œ
      const now = new Date();
      const dateStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
      
      // ìˆœìœ„í‘œì— ì¶”ê°€
      leaderboardData.push({
        nickname: nickname,
        emojis: currentEmojis,
        score: currentScore,
        date: dateStr,
        story: story,
        evaluation: result
      });
      
      // ì ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬
      leaderboardData.sort((a, b) => b.score - a.score);
      
      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
      localStorage.setItem('emojiGameLeaderboard', JSON.stringify(leaderboardData));
      
      alert('ê²°ê³¼ê°€ ìˆœìœ„í‘œì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      updateLeaderboardDisplay();
    }
    
    // ìˆœìœ„í‘œ ì—…ë°ì´íŠ¸
    function updateLeaderboardDisplay() {
      const leaderboardBody = document.getElementById('leaderboardBody');
      leaderboardBody.innerHTML = '';
      
      if (leaderboardData.length === 0) {
        const row = document.createElement('tr');
        row.innerHTML = '<td colspan="5" style="text-align:center;">ì•„ì§ ì €ì¥ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td>';
        leaderboardBody.appendChild(row);
        return;
      }
      
      leaderboardData.forEach((entry, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${entry.nickname}</td>
          <td>${entry.emojis}</td>
          <td class="score">${entry.score}</td>
          <td>${entry.date}</td>
        `;
        
        // í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
        row.style.cursor = 'pointer';
        row.title = 'í´ë¦­í•˜ì—¬ ì´ì•¼ê¸° ë‚´ìš© ë³´ê¸°';
        row.addEventListener('click', () => {
          alert(`${entry.nickname}ì˜ ì´ì•¼ê¸°\n\n${entry.story}\n\ní‰ê°€:\n${entry.evaluation}`);
        });
        
        leaderboardBody.appendChild(row);
      });
    }
    
    // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    startBtn.addEventListener('click', async () => {
      const emojis = await getEmojisFromAI();
      if (emojis) {
        currentEmojis = emojis;
        emojiDisplay.textContent = emojis;
        storyInput.value = '';
        resultDisplay.innerHTML = '';
        submitBtn.disabled = false;
        saveBtn.disabled = true;
      }
    });
    
    submitBtn.addEventListener('click', async () => {
      const story = storyInput.value.trim();
      if (!story) {
        alert('ì´ì•¼ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const result = await evaluateStory(currentEmojis, story);
      if (result) {
        resultDisplay.innerHTML = result.replace(/\n/g, '<br>');
        saveBtn.disabled = false;
      }
    });
    
    saveBtn.addEventListener('click', saveResult);
    
    // ì´ˆê¸° ë¡œë“œ ì‹œ ìˆœìœ„í‘œ ì—…ë°ì´íŠ¸
    updateLeaderboardDisplay();
  </script>
</body>
</html>
